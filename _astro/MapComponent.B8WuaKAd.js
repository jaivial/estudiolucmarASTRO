import{j as y}from"./jsx-runtime.BVREIxrz.js";import{r as g,R as at}from"./index.BJiRiHOl.js";import{g as Rt}from"./_commonjsHelpers.Cpj98o6Y.js";import{c as _t,l as w,a as ft,e as mt,u as Ut,b as lt,d as tt,M as zt,T as Ht,f as Gt}from"./leaflet.B5POFVOl.js";import{a as x}from"./axios.B4uVmeYG.js";import"./index.DKOwD38h.js";const Nt=_t(function({children:r,...s},a){const t=new w.FeatureGroup([],s);return ft(t,mt(a,{layerContainer:t,overlayContainer:t}))}),At=_t(function({positions:r,...s},a){const t=new w.Polygon(r,s);return ft(t,mt(a,{overlayContainer:t}))},function(r,s,a){s.positions!==a.positions&&r.setLatLngs(s.positions)});var Lt={exports:{}},jt="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Ft=jt,Bt=Ft;function gt(){}function vt(){}vt.resetWarningCache=gt;var Vt=function(){function o(a,t,e,i,n,l){if(l!==Bt){var h=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw h.name="Invariant Violation",h}}o.isRequired=o;function r(){return o}var s={array:o,bigint:o,bool:o,func:o,number:o,object:o,string:o,symbol:o,any:o,arrayOf:r,element:o,elementType:o,instanceOf:r,node:o,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:vt,resetWarningCache:gt};return s.PropTypes=s,s};Lt.exports=Vt();var f=Lt.exports;(function(o,r,s){function a(t,e){for(;(t=t.parentElement)&&!t.classList.contains(e););return t}L.drawVersion="1.0.4",L.Draw={},L.drawLocal={draw:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},finish:{title:"Finish drawing",text:"Finish"},undo:{title:"Delete last point drawn",text:"Delete last point"},buttons:{polyline:"Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",circle:"Draw a circle",marker:"Draw a marker",circlemarker:"Draw a circlemarker"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle."},radius:"Radius"},circlemarker:{tooltip:{start:"Click map to place circle marker."}},marker:{tooltip:{start:"Click map to place marker."}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing line.",cont:"Click to continue drawing line.",end:"Click last point to finish line."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},simpleshape:{tooltip:{end:"Release mouse to finish drawing."}}}},edit:{toolbar:{actions:{save:{title:"Save changes",text:"Save"},cancel:{title:"Cancel editing, discards all changes",text:"Cancel"},clearAll:{title:"Clear all layers",text:"Clear All"}},buttons:{edit:"Edit layers",editDisabled:"No layers to edit",remove:"Delete layers",removeDisabled:"No layers to delete"}},handlers:{edit:{tooltip:{text:"Drag handles or markers to edit features.",subtext:"Click cancel to undo changes."}},remove:{tooltip:{text:"Click on a feature to remove."}}}}},L.Draw.Event={},L.Draw.Event.CREATED="draw:created",L.Draw.Event.EDITED="draw:edited",L.Draw.Event.DELETED="draw:deleted",L.Draw.Event.DRAWSTART="draw:drawstart",L.Draw.Event.DRAWSTOP="draw:drawstop",L.Draw.Event.DRAWVERTEX="draw:drawvertex",L.Draw.Event.EDITSTART="draw:editstart",L.Draw.Event.EDITMOVE="draw:editmove",L.Draw.Event.EDITRESIZE="draw:editresize",L.Draw.Event.EDITVERTEX="draw:editvertex",L.Draw.Event.EDITSTOP="draw:editstop",L.Draw.Event.DELETESTART="draw:deletestart",L.Draw.Event.DELETESTOP="draw:deletestop",L.Draw.Event.TOOLBAROPENED="draw:toolbaropened",L.Draw.Event.TOOLBARCLOSED="draw:toolbarclosed",L.Draw.Event.MARKERCONTEXT="draw:markercontext",L.Draw=L.Draw||{},L.Draw.Feature=L.Handler.extend({initialize:function(t,e){this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,e&&e.shapeOptions&&(e.shapeOptions=L.Util.extend({},this.options.shapeOptions,e.shapeOptions)),L.setOptions(this,e);var i=L.version.split(".");parseInt(i[0],10)===1&&parseInt(i[1],10)>=2?L.Draw.Feature.include(L.Evented.prototype):L.Draw.Feature.include(L.Mixin.Events)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DRAWSTART,{layerType:this.type}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DRAWSTOP,{layerType:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(L.DomUtil.disableTextSelection(),t.getContainer().focus(),this._tooltip=new L.Draw.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(t){L.setOptions(this,t)},_fireCreatedEvent:function(t){this._map.fire(L.Draw.Event.CREATED,{layer:t,layerType:this.type})},_cancelDrawing:function(t){t.keyCode===27&&(this._map.fire("draw:canceled",{layerType:this.type}),this.disable())}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,feet:!0,nautic:!1,showLength:!0,zIndexOffset:2e3,factor:1,maxPoints:0},initialize:function(t,e){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error,e&&e.drawError&&(e.drawError=L.Util.extend({},this.options.drawError,e.drawError)),this.type=L.Draw.Polyline.TYPE,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mouseout",this._onMouseOut,this).on("mousemove",this._onMouseMove,this).on("mousedown",this._onMouseDown,this).on("mouseup",this._onMouseUp,this).addTo(this._map),this._map.on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).on("zoomlevelschange",this._onZoomEnd,this).on("touchstart",this._onTouch,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this).off("zoomlevelschange",this._onZoomEnd,this).off("zoomend",this._onZoomEnd,this).off("touchstart",this._onTouch,this).off("click",this._onTouch,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var t=this._markers.pop(),e=this._poly,i=e.getLatLngs(),n=i.splice(-1,1)[0];this._poly.setLatLngs(i),this._markerGroup.removeLayer(t),e.getLatLngs().length<2&&this._map.removeLayer(e),this._vertexChanged(n,!1)}},addVertex:function(t){if(this._markers.length>=2&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(t))return void this._showErrorTooltip();this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(t)),this._poly.addLatLng(t),this._poly.getLatLngs().length===2&&this._map.addLayer(this._poly),this._vertexChanged(t,!0)},completeShape:function(){this._markers.length<=1||!this._shapeIsValid()||(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_finishShape:function(){var t=this._poly._defaultShape?this._poly._defaultShape():this._poly.getLatLngs(),e=this._poly.newLatLngIntersects(t[t.length-1]);if(!this.options.allowIntersection&&e||!this._shapeIsValid())return void this._showErrorTooltip();this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_shapeIsValid:function(){return!0},_onZoomEnd:function(){this._markers!==null&&this._updateGuide()},_onMouseMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent),i=this._map.layerPointToLatLng(e);this._currentLatLng=i,this._updateTooltip(i),this._updateGuide(e),this._mouseMarker.setLatLng(i),L.DomEvent.preventDefault(t.originalEvent)},_vertexChanged:function(t,e){this._map.fire(L.Draw.Event.DRAWVERTEX,{layers:this._markerGroup}),this._updateFinishHandler(),this._updateRunningMeasure(t,e),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(t){if(!this._clickHandled&&!this._touchHandled&&!this._disableMarkers){this._onMouseMove(t),this._clickHandled=!0,this._disableNewMarkers();var e=t.originalEvent,i=e.clientX,n=e.clientY;this._startPoint.call(this,i,n)}},_startPoint:function(t,e){this._mouseDownOrigin=L.point(t,e)},_onMouseUp:function(t){var e=t.originalEvent,i=e.clientX,n=e.clientY;this._endPoint.call(this,i,n,t),this._clickHandled=null},_endPoint:function(t,e,i){if(this._mouseDownOrigin){var n=L.point(t,e).distanceTo(this._mouseDownOrigin),l=this._calculateFinishDistance(i.latlng);this.options.maxPoints>1&&this.options.maxPoints==this._markers.length+1?(this.addVertex(i.latlng),this._finishShape()):l<10&&L.Browser.touch?this._finishShape():Math.abs(n)<9*(o.devicePixelRatio||1)&&this.addVertex(i.latlng),this._enableNewMarkers()}this._mouseDownOrigin=null},_onTouch:function(t){var e,i,n=t.originalEvent;!n.touches||!n.touches[0]||this._clickHandled||this._touchHandled||this._disableMarkers||(e=n.touches[0].clientX,i=n.touches[0].clientY,this._disableNewMarkers(),this._touchHandled=!0,this._startPoint.call(this,e,i),this._endPoint.call(this,e,i,t),this._touchHandled=null),this._clickHandled=null},_onMouseOut:function(){this._tooltip&&this._tooltip._onMouseOut.call(this._tooltip)},_calculateFinishDistance:function(t){var e;if(this._markers.length>0){var i;if(this.type===L.Draw.Polyline.TYPE)i=this._markers[this._markers.length-1];else{if(this.type!==L.Draw.Polygon.TYPE)return 1/0;i=this._markers[0]}var n=this._map.latLngToContainerPoint(i.getLatLng()),l=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset}),h=this._map.latLngToContainerPoint(l.getLatLng());e=n.distanceTo(h)}else e=1/0;return e},_updateFinishHandler:function(){var t=this._markers.length;t>1&&this._markers[t-1].on("click",this._finishShape,this),t>2&&this._markers[t-2].off("click",this._finishShape,this)},_createMarker:function(t){var e=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(e),e},_updateGuide:function(t){var e=this._markers?this._markers.length:0;e>0&&(t=t||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[e-1].getLatLng()),t))},_updateTooltip:function(t){var e=this._getTooltipText();t&&this._tooltip.updatePosition(t),this._errorShown||this._tooltip.updateContent(e)},_drawGuide:function(t,e){var i,n,l,h=Math.floor(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))),c=this.options.guidelineDistance,u=this.options.maxGuideLineLength,m=h>u?h-u:c;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));m<h;m+=this.options.guidelineDistance)i=m/h,n={x:Math.floor(t.x*(1-i)+i*e.x),y:Math.floor(t.y*(1-i)+i*e.y)},l=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),l.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(l,n)},_updateGuideColor:function(t){if(this._guidesContainer)for(var e=0,i=this._guidesContainer.childNodes.length;e<i;e++)this._guidesContainer.childNodes[e].style.backgroundColor=t},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var t,e,i=this.options.showLength;return this._markers.length===0?t={text:L.drawLocal.draw.handlers.polyline.tooltip.start}:(e=i?this._getMeasurementString():"",t=this._markers.length===1?{text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:e}:{text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:e}),t},_updateRunningMeasure:function(t,e){var i,n,l=this._markers.length;this._markers.length===1?this._measurementRunningTotal=0:(i=l-(e?2:1),n=L.GeometryUtil.isVersion07x()?t.distanceTo(this._markers[i].getLatLng())*(this.options.factor||1):this._map.distance(t,this._markers[i].getLatLng())*(this.options.factor||1),this._measurementRunningTotal+=n*(e?1:-1))},_getMeasurementString:function(){var t,e=this._currentLatLng,i=this._markers[this._markers.length-1].getLatLng();return t=L.GeometryUtil.isVersion07x()?i&&e&&e.distanceTo?this._measurementRunningTotal+e.distanceTo(i)*(this.options.factor||1):this._measurementRunningTotal||0:i&&e?this._measurementRunningTotal+this._map.distance(e,i)*(this.options.factor||1):this._measurementRunningTotal||0,L.GeometryUtil.readableDistance(t,this.options.metric,this.options.feet,this.options.nautic,this.options.precision)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_disableNewMarkers:function(){this._disableMarkers=!0},_enableNewMarkers:function(){setTimeout(function(){this._disableMarkers=!1}.bind(this),50)},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var t=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,showLength:!1,shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},metric:!0,feet:!0,nautic:!1,precision:{}},initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var t=this._markers.length;t===1&&this._markers[0].on("click",this._finishShape,this),t>2&&(this._markers[t-1].on("dblclick",this._finishShape,this),t>3&&this._markers[t-2].off("dblclick",this._finishShape,this))},_getTooltipText:function(){var t,e;return this._markers.length===0?t=L.drawLocal.draw.handlers.polygon.tooltip.start:this._markers.length<3?(t=L.drawLocal.draw.handlers.polygon.tooltip.cont,e=this._getMeasurementString()):(t=L.drawLocal.draw.handlers.polygon.tooltip.end,e=this._getMeasurementString()),{text:t,subtext:e}},_getMeasurementString:function(){var t=this._area,e="";return t||this.options.showLength?(this.options.showLength&&(e=L.Draw.Polyline.prototype._getMeasurementString.call(this)),t&&(e+="<br>"+L.GeometryUtil.readableArea(t,this.options.metric,this.options.precision)),e):null},_shapeIsValid:function(){return this._markers.length>=3},_vertexChanged:function(t,e){var i;!this.options.allowIntersection&&this.options.showArea&&(i=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(i)),L.Draw.Polyline.prototype._vertexChanged.call(this,t,e)},_cleanUpShape:function(){var t=this._markers.length;t>0&&(this._markers[0].off("click",this._finishShape,this),t>2&&this._markers[t-1].off("dblclick",this._finishShape,this))}}),L.SimpleShape={},L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:!1},initialize:function(t,e){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._mapDraggable=this._map.dragging.enabled(),this._mapDraggable&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this).on("touchstart",this._onMouseDown,this).on("touchmove",this._onMouseMove,this),r.addEventListener("touchstart",L.DomEvent.preventDefault,{passive:!1}))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._mapDraggable&&this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this).off("touchstart",this._onMouseDown,this).off("touchmove",this._onMouseMove,this),L.DomEvent.off(r,"mouseup",this._onMouseUp,this),L.DomEvent.off(r,"touchend",this._onMouseUp,this),r.removeEventListener("touchstart",L.DomEvent.preventDefault),this._shape&&(this._map.removeLayer(this._shape),delete this._shape)),this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(t){this._isDrawing=!0,this._startLatLng=t.latlng,L.DomEvent.on(r,"mouseup",this._onMouseUp,this).on(r,"touchend",this._onMouseUp,this).preventDefault(t.originalEvent)},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._isDrawing&&(this._tooltip.updateContent(this._getTooltipText()),this._drawShape(e))},_onMouseUp:function(){this._shape&&this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()}}),L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showArea:!0,metric:!0},initialize:function(t,e){this.type=L.Draw.Rectangle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},disable:function(){this._enabled&&(this._isCurrentlyTwoClickDrawing=!1,L.Draw.SimpleShape.prototype.disable.call(this))},_onMouseUp:function(t){if(!this._shape&&!this._isCurrentlyTwoClickDrawing)return void(this._isCurrentlyTwoClickDrawing=!0);this._isCurrentlyTwoClickDrawing&&!a(t.target,"leaflet-pane")||L.Draw.SimpleShape.prototype._onMouseUp.call(this)},_drawShape:function(t){this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,t)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,t),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_getTooltipText:function(){var t,e,i,n=L.Draw.SimpleShape.prototype._getTooltipText.call(this),l=this._shape,h=this.options.showArea;return l&&(t=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),e=L.GeometryUtil.geodesicArea(t),i=h?L.GeometryUtil.readableArea(e,this.options.metric):""),{text:n.text,subtext:i}}}),L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2e3},initialize:function(t,e){this.type=L.Draw.Marker.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.marker.tooltip.start,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._tooltip.updateContent({text:this._initialLabelText}),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onTouch,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._map.off("click",this._onClick,this).off("click",this._onTouch,this),this._marker&&(this._marker.off("click",this._onClick,this),this._map.removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._mouseMarker.setLatLng(e),this._marker?(e=this._mouseMarker.getLatLng(),this._marker.setLatLng(e)):(this._marker=this._createMarker(e),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_createMarker:function(t){return new L.Marker(t,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset})},_onClick:function(){this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_onTouch:function(t){this._onMouseMove(t),this._onClick()},_fireCreatedEvent:function(){var t=new L.Marker.Touch(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Draw.CircleMarker=L.Draw.Marker.extend({statics:{TYPE:"circlemarker"},options:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,zIndexOffset:2e3},initialize:function(t,e){this.type=L.Draw.CircleMarker.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circlemarker.tooltip.start,L.Draw.Feature.prototype.initialize.call(this,t,e)},_fireCreatedEvent:function(){var t=new L.CircleMarker(this._marker.getLatLng(),this.options);L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)},_createMarker:function(t){return new L.CircleMarker(t,this.options)}}),L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showRadius:!0,metric:!0,feet:!0,nautic:!1},initialize:function(t,e){this.type=L.Draw.Circle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},_drawShape:function(t){if(L.GeometryUtil.isVersion07x())var e=this._startLatLng.distanceTo(t);else var e=this._map.distance(this._startLatLng,t);this._shape?this._shape.setRadius(e):(this._shape=new L.Circle(this._startLatLng,e,this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_onMouseMove:function(t){var e,i=t.latlng,n=this.options.showRadius,l=this.options.metric;if(this._tooltip.updatePosition(i),this._isDrawing){this._drawShape(i),e=this._shape.getRadius().toFixed(1);var h="";n&&(h=L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(e,l,this.options.feet,this.options.nautic)),this._tooltip.updateContent({text:this._endLabelText,subtext:h})}}}),L.Edit=L.Edit||{},L.Edit.Marker=L.Handler.extend({initialize:function(t,e){this._marker=t,L.setOptions(this,e)},addHooks:function(){var t=this._marker;t.dragging.enable(),t.on("dragend",this._onDragEnd,t),this._toggleMarkerHighlight()},removeHooks:function(){var t=this._marker;t.dragging.disable(),t.off("dragend",this._onDragEnd,t),this._toggleMarkerHighlight()},_onDragEnd:function(t){var e=t.target;e.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:e})},_toggleMarkerHighlight:function(){var t=this._marker._icon;t&&(t.style.display="none",L.DomUtil.hasClass(t,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,-4)):(L.DomUtil.addClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,4)),t.style.display="")},_offsetMarker:function(t,e){var i=parseInt(t.style.marginTop,10)-e,n=parseInt(t.style.marginLeft,10)-e;t.style.marginTop=i+"px",t.style.marginLeft=n+"px"}}),L.Marker.addInitHook(function(){L.Edit.Marker&&(this.editing=new L.Edit.Marker(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.Poly=L.Handler.extend({initialize:function(t){this.latlngs=[t._latlngs],t._holes&&(this.latlngs=this.latlngs.concat(t._holes)),this._poly=t,this._poly.on("revert-edited",this._updateLatLngs,this)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._poly._latlngs)?this._poly._latlngs:this._poly._latlngs[0]:this._poly._latlngs},_eachVertexHandler:function(t){for(var e=0;e<this._verticesHandlers.length;e++)t(this._verticesHandlers[e])},addHooks:function(){this._initHandlers(),this._eachVertexHandler(function(t){t.addHooks()})},removeHooks:function(){this._eachVertexHandler(function(t){t.removeHooks()})},updateMarkers:function(){this._eachVertexHandler(function(t){t.updateMarkers()})},_initHandlers:function(){this._verticesHandlers=[];for(var t=0;t<this.latlngs.length;t++)this._verticesHandlers.push(new L.Edit.PolyVerticesEdit(this._poly,this.latlngs[t],this._poly.options.poly))},_updateLatLngs:function(t){this.latlngs=[t.layer._latlngs],t.layer._holes&&(this.latlngs=this.latlngs.concat(t.layer._holes))}}),L.Edit.PolyVerticesEdit=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),drawError:{color:"#b00b00",timeout:1e3}},initialize:function(t,e,i){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this._poly=t,i&&i.drawError&&(i.drawError=L.Util.extend({},this.options.drawError,i.drawError)),this._latlngs=e,L.setOptions(this,i)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]:this._latlngs},addHooks:function(){var t=this._poly,e=t._path;t instanceof L.Polygon||(t.options.fill=!1,t.options.editing&&(t.options.editing.fill=!1)),e&&t.options.editing&&t.options.editing.className&&(t.options.original.className&&t.options.original.className.split(" ").forEach(function(i){L.DomUtil.removeClass(e,i)}),t.options.editing.className.split(" ").forEach(function(i){L.DomUtil.addClass(e,i)})),t.setStyle(t.options.editing),this._poly._map&&(this._map=this._poly._map,this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){var t=this._poly,e=t._path;e&&t.options.editing&&t.options.editing.className&&(t.options.editing.className.split(" ").forEach(function(i){L.DomUtil.removeClass(e,i)}),t.options.original.className&&t.options.original.className.split(" ").forEach(function(i){L.DomUtil.addClass(e,i)})),t.setStyle(t.options.original),t._map&&(t._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];var t,e,i,n,l=this._defaultShape();for(t=0,i=l.length;t<i;t++)n=this._createMarker(l[t],t),n.on("click",this._onMarkerClick,this),n.on("contextmenu",this._onContextMenu,this),this._markers.push(n);var h,c;for(t=0,e=i-1;t<i;e=t++)(t!==0||L.Polygon&&this._poly instanceof L.Polygon)&&(h=this._markers[e],c=this._markers[t],this._createMiddleMarker(h,c),this._updatePrevNext(h,c))},_createMarker:function(t,e){var i=new L.Marker.Touch(t,{draggable:!0,icon:this.options.icon});return i._origLatLng=t,i._index=e,i.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._fireEdit,this).on("touchmove",this._onTouchMove,this).on("touchend",this._fireEdit,this).on("MSPointerMove",this._onTouchMove,this).on("MSPointerUp",this._fireEdit,this),this._markerGroup.addLayer(i),i},_onMarkerDragStart:function(){this._poly.fire("editstart")},_spliceLatLngs:function(){var t=this._defaultShape(),e=[].splice.apply(t,arguments);return this._poly._convertLatLngs(t,!0),this._poly.redraw(),e},_removeMarker:function(t){var e=t._index;this._markerGroup.removeLayer(t),this._markers.splice(e,1),this._spliceLatLngs(e,1),this._updateIndexes(e,-1),t.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("touchmove",this._onMarkerDrag,this).off("touchend",this._fireEdit,this).off("click",this._onMarkerClick,this).off("MSPointerMove",this._onTouchMove,this).off("MSPointerUp",this._fireEdit,this)},_fireEdit:function(){this._poly.edited=!0,this._poly.fire("edit"),this._poly._map.fire(L.Draw.Event.EDITVERTEX,{layers:this._markerGroup,poly:this._poly})},_onMarkerDrag:function(t){var e=t.target,i=this._poly,n=L.LatLngUtil.cloneLatLng(e._origLatLng);if(L.extend(e._origLatLng,e._latlng),i.options.poly){var l=i._map._editTooltip;if(!i.options.poly.allowIntersection&&i.intersects()){L.extend(e._origLatLng,n),e.setLatLng(n);var h=i.options.color;i.setStyle({color:this.options.drawError.color}),l&&l.updateContent({text:L.drawLocal.draw.handlers.polyline.error}),setTimeout(function(){i.setStyle({color:h}),l&&l.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext})},1e3)}}e._middleLeft&&e._middleLeft.setLatLng(this._getMiddleLatLng(e._prev,e)),e._middleRight&&e._middleRight.setLatLng(this._getMiddleLatLng(e,e._next)),this._poly._bounds._southWest=L.latLng(1/0,1/0),this._poly._bounds._northEast=L.latLng(-1/0,-1/0);var c=this._poly.getLatLngs();this._poly._convertLatLngs(c,!0),this._poly.redraw(),this._poly.fire("editdrag")},_onMarkerClick:function(t){var e=L.Polygon&&this._poly instanceof L.Polygon?4:3,i=t.target;this._defaultShape().length<e||(this._removeMarker(i),this._updatePrevNext(i._prev,i._next),i._middleLeft&&this._markerGroup.removeLayer(i._middleLeft),i._middleRight&&this._markerGroup.removeLayer(i._middleRight),i._prev&&i._next?this._createMiddleMarker(i._prev,i._next):i._prev?i._next||(i._prev._middleRight=null):i._next._middleLeft=null,this._fireEdit())},_onContextMenu:function(t){var e=t.target;this._poly,this._poly._map.fire(L.Draw.Event.MARKERCONTEXT,{marker:e,layers:this._markerGroup,poly:this._poly}),L.DomEvent.stopPropagation},_onTouchMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent.touches[0]),i=this._map.layerPointToLatLng(e),n=t.target;L.extend(n._origLatLng,i),n._middleLeft&&n._middleLeft.setLatLng(this._getMiddleLatLng(n._prev,n)),n._middleRight&&n._middleRight.setLatLng(this._getMiddleLatLng(n,n._next)),this._poly.redraw(),this.updateMarkers()},_updateIndexes:function(t,e){this._markerGroup.eachLayer(function(i){i._index>t&&(i._index+=e)})},_createMiddleMarker:function(t,e){var i,n,l,h=this._getMiddleLatLng(t,e),c=this._createMarker(h);c.setOpacity(.6),t._middleRight=e._middleLeft=c,n=function(){c.off("touchmove",n,this);var u=e._index;c._index=u,c.off("click",i,this).on("click",this._onMarkerClick,this),h.lat=c.getLatLng().lat,h.lng=c.getLatLng().lng,this._spliceLatLngs(u,0,h),this._markers.splice(u,0,c),c.setOpacity(1),this._updateIndexes(u,1),e._index++,this._updatePrevNext(t,c),this._updatePrevNext(c,e),this._poly.fire("editstart")},l=function(){c.off("dragstart",n,this),c.off("dragend",l,this),c.off("touchmove",n,this),this._createMiddleMarker(t,c),this._createMiddleMarker(c,e)},i=function(){n.call(this),l.call(this),this._fireEdit()},c.on("click",i,this).on("dragstart",n,this).on("dragend",l,this).on("touchmove",n,this),this._markerGroup.addLayer(c)},_updatePrevNext:function(t,e){t&&(t._next=e),e&&(e._prev=t)},_getMiddleLatLng:function(t,e){var i=this._poly._map,n=i.project(t.getLatLng()),l=i.project(e.getLatLng());return i.unproject(n._add(l)._divideBy(2))}}),L.Polyline.addInitHook(function(){this.editing||(L.Edit.Poly&&(this.editing=new L.Edit.Poly(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))}),L.Edit=L.Edit||{},L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"}),touchMoveIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move leaflet-touch-icon"}),touchResizeIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize leaflet-touch-icon"})},initialize:function(t,e){L.Browser.touch&&(this.options.moveIcon=this.options.touchMoveIcon,this.options.resizeIcon=this.options.touchResizeIcon),this._shape=t,L.Util.setOptions(this,e)},addHooks:function(){var t=this._shape;this._shape._map&&(this._map=this._shape._map,t.setStyle(t.options.editing),t._map&&(this._map=t._map,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup)))},removeHooks:function(){var t=this._shape;if(t.setStyle(t.options.original),t._map){this._unbindMarker(this._moveMarker);for(var e=0,i=this._resizeMarkers.length;e<i;e++)this._unbindMarker(this._resizeMarkers[e]);this._resizeMarkers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._createMoveMarker(),this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(t,e){var i=new L.Marker.Touch(t,{draggable:!0,icon:e,zIndexOffset:10});return this._bindMarker(i),this._markerGroup.addLayer(i),i},_bindMarker:function(t){t.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this).on("touchstart",this._onTouchStart,this).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onTouchEnd,this).on("MSPointerUp",this._onTouchEnd,this)},_unbindMarker:function(t){t.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._onMarkerDragEnd,this).off("touchstart",this._onTouchStart,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onTouchEnd,this).off("MSPointerUp",this._onTouchEnd,this)},_onMarkerDragStart:function(t){t.target.setOpacity(0),this._shape.fire("editstart")},_fireEdit:function(){this._shape.edited=!0,this._shape.fire("edit")},_onMarkerDrag:function(t){var e=t.target,i=e.getLatLng();e===this._moveMarker?this._move(i):this._resize(i),this._shape.redraw(),this._shape.fire("editdrag")},_onMarkerDragEnd:function(t){t.target.setOpacity(1),this._fireEdit()},_onTouchStart:function(t){if(L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,t),typeof this._getCorners=="function"){var e=this._getCorners(),i=t.target,n=i._cornerIndex;i.setOpacity(0),this._oppositeCorner=e[(n+2)%4],this._toggleCornerMarkers(0,n)}this._shape.fire("editstart")},_onTouchMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent.touches[0]),i=this._map.layerPointToLatLng(e);return t.target===this._moveMarker?this._move(i):this._resize(i),this._shape.redraw(),!1},_onTouchEnd:function(t){t.target.setOpacity(1),this.updateMarkers(),this._fireEdit()},_move:function(){},_resize:function(){}}),L.Edit=L.Edit||{},L.Edit.Rectangle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var t=this._shape.getBounds(),e=t.getCenter();this._moveMarker=this._createMarker(e,this.options.moveIcon)},_createResizeMarker:function(){var t=this._getCorners();this._resizeMarkers=[];for(var e=0,i=t.length;e<i;e++)this._resizeMarkers.push(this._createMarker(t[e],this.options.resizeIcon)),this._resizeMarkers[e]._cornerIndex=e},_onMarkerDragStart:function(t){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,t);var e=this._getCorners(),i=t.target,n=i._cornerIndex;this._oppositeCorner=e[(n+2)%4],this._toggleCornerMarkers(0,n)},_onMarkerDragEnd:function(t){var e,i,n=t.target;n===this._moveMarker&&(e=this._shape.getBounds(),i=e.getCenter(),n.setLatLng(i)),this._toggleCornerMarkers(1),this._repositionCornerMarkers(),L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,t)},_move:function(t){for(var e,i=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),n=this._shape.getBounds(),l=n.getCenter(),h=[],c=0,u=i.length;c<u;c++)e=[i[c].lat-l.lat,i[c].lng-l.lng],h.push([t.lat+e[0],t.lng+e[1]]);this._shape.setLatLngs(h),this._repositionCornerMarkers(),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})},_resize:function(t){var e;this._shape.setBounds(L.latLngBounds(t,this._oppositeCorner)),e=this._shape.getBounds(),this._moveMarker.setLatLng(e.getCenter()),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})},_getCorners:function(){var t=this._shape.getBounds();return[t.getNorthWest(),t.getNorthEast(),t.getSouthEast(),t.getSouthWest()]},_toggleCornerMarkers:function(t){for(var e=0,i=this._resizeMarkers.length;e<i;e++)this._resizeMarkers[e].setOpacity(t)},_repositionCornerMarkers:function(){for(var t=this._getCorners(),e=0,i=this._resizeMarkers.length;e<i;e++)this._resizeMarkers[e].setLatLng(t[e])}}),L.Rectangle.addInitHook(function(){L.Edit.Rectangle&&(this.editing=new L.Edit.Rectangle(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.CircleMarker=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var t=this._shape.getLatLng();this._moveMarker=this._createMarker(t,this.options.moveIcon)},_createResizeMarker:function(){this._resizeMarkers=[]},_move:function(t){if(this._resizeMarkers.length){var e=this._getResizeMarkerPoint(t);this._resizeMarkers[0].setLatLng(e)}this._shape.setLatLng(t),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})}}),L.CircleMarker.addInitHook(function(){L.Edit.CircleMarker&&(this.editing=new L.Edit.CircleMarker(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()})}),L.Edit=L.Edit||{},L.Edit.Circle=L.Edit.CircleMarker.extend({_createResizeMarker:function(){var t=this._shape.getLatLng(),e=this._getResizeMarkerPoint(t);this._resizeMarkers=[],this._resizeMarkers.push(this._createMarker(e,this.options.resizeIcon))},_getResizeMarkerPoint:function(t){var e=this._shape._radius*Math.cos(Math.PI/4),i=this._map.project(t);return this._map.unproject([i.x+e,i.y-e])},_resize:function(t){var e=this._moveMarker.getLatLng();L.GeometryUtil.isVersion07x()?radius=e.distanceTo(t):radius=this._map.distance(e,t),this._shape.setRadius(radius),this._map.editTooltip&&this._map._editTooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.subtext+"<br />"+L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(radius,!0,this.options.feet,this.options.nautic)}),this._shape.setRadius(radius),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})}}),L.Circle.addInitHook(function(){L.Edit.Circle&&(this.editing=new L.Edit.Circle(this),this.options.editable&&this.editing.enable())}),L.Map.mergeOptions({touchExtend:!0}),L.Map.TouchExtend=L.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane},addHooks:function(){L.DomEvent.on(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.on(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.on(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.on(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.on(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.on(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.on(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.on(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.on(this._container,"touchleave",this._onTouchLeave,this))},removeHooks:function(){L.DomEvent.off(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.off(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.off(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.off(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.off(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.off(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.off(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.off(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.off(this._container,"touchleave",this._onTouchLeave,this))},_touchEvent:function(t,e){var i={};if(t.touches!==void 0){if(!t.touches.length)return;i=t.touches[0]}else if(t.pointerType!=="touch"||(i=t,!this._filterClick(t)))return;var n=this._map.mouseEventToContainerPoint(i),l=this._map.mouseEventToLayerPoint(i),h=this._map.layerPointToLatLng(l);this._map.fire(e,{latlng:h,layerPoint:l,containerPoint:n,pageX:i.pageX,pageY:i.pageY,originalEvent:t})},_filterClick:function(t){var e=t.timeStamp||t.originalEvent.timeStamp,i=L.DomEvent._lastClick&&e-L.DomEvent._lastClick;return i&&i>100&&i<500||t.target._simulatedClick&&!t._simulated?(L.DomEvent.stop(t),!1):(L.DomEvent._lastClick=e,!0)},_onTouchStart:function(t){this._map._loaded&&this._touchEvent(t,"touchstart")},_onTouchEnd:function(t){this._map._loaded&&this._touchEvent(t,"touchend")},_onTouchCancel:function(t){if(this._map._loaded){var e="touchcancel";this._detectIE()&&(e="pointercancel"),this._touchEvent(t,e)}},_onTouchLeave:function(t){this._map._loaded&&this._touchEvent(t,"touchleave")},_onTouchMove:function(t){this._map._loaded&&this._touchEvent(t,"touchmove")},_detectIE:function(){var t=o.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){var i=t.indexOf("rv:");return parseInt(t.substring(i+3,t.indexOf(".",i)),10)}var n=t.indexOf("Edge/");return n>0&&parseInt(t.substring(n+5,t.indexOf(".",n)),10)}}),L.Map.addInitHook("addHandler","touchExtend",L.Map.TouchExtend),L.Marker.Touch=L.Marker.extend({_initInteraction:function(){return this.addInteractiveTarget?L.Marker.prototype._initInteraction.apply(this):this._initInteractionLegacy()},_initInteractionLegacy:function(){if(this.options.clickable){var t=this._icon,e=["dblclick","mousedown","mouseover","mouseout","contextmenu","touchstart","touchend","touchmove"];this._detectIE?e.concat(["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"]):e.concat(["touchcancel"]),L.DomUtil.addClass(t,"leaflet-clickable"),L.DomEvent.on(t,"click",this._onMouseClick,this),L.DomEvent.on(t,"keypress",this._onKeyPress,this);for(var i=0;i<e.length;i++)L.DomEvent.on(t,e[i],this._fireMouseEvent,this);L.Handler.MarkerDrag&&(this.dragging=new L.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_detectIE:function(){var t=o.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){var i=t.indexOf("rv:");return parseInt(t.substring(i+3,t.indexOf(".",i)),10)}var n=t.indexOf("Edge/");return n>0&&parseInt(t.substring(n+5,t.indexOf(".",n)),10)}}),L.LatLngUtil={cloneLatLngs:function(t){for(var e=[],i=0,n=t.length;i<n;i++)Array.isArray(t[i])?e.push(L.LatLngUtil.cloneLatLngs(t[i])):e.push(this.cloneLatLng(t[i]));return e},cloneLatLng:function(t){return L.latLng(t.lat,t.lng)}},function(){var t={km:2,ha:2,m:0,mi:2,ac:2,yd:0,ft:0,nm:2};L.GeometryUtil=L.extend(L.GeometryUtil||{},{geodesicArea:function(e){var i,n,l=e.length,h=0,c=Math.PI/180;if(l>2){for(var u=0;u<l;u++)i=e[u],n=e[(u+1)%l],h+=(n.lng-i.lng)*c*(2+Math.sin(i.lat*c)+Math.sin(n.lat*c));h=6378137*h*6378137/2}return Math.abs(h)},formattedNumber:function(e,i){var n=parseFloat(e).toFixed(i),l=L.drawLocal.format&&L.drawLocal.format.numeric,h=l&&l.delimiters,c=h&&h.thousands,u=h&&h.decimal;if(c||u){var m=n.split(".");n=c?m[0].replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+c):m[0],u=u||".",m.length>1&&(n=n+u+m[1])}return n},readableArea:function(e,i,c){var l,h,c=L.Util.extend({},t,c);return i?(h=["ha","m"],type=typeof i,type==="string"?h=[i]:type!=="boolean"&&(h=i),l=e>=1e6&&h.indexOf("km")!==-1?L.GeometryUtil.formattedNumber(1e-6*e,c.km)+" km²":e>=1e4&&h.indexOf("ha")!==-1?L.GeometryUtil.formattedNumber(1e-4*e,c.ha)+" ha":L.GeometryUtil.formattedNumber(e,c.m)+" m²"):(e/=.836127,l=e>=3097600?L.GeometryUtil.formattedNumber(e/3097600,c.mi)+" mi²":e>=4840?L.GeometryUtil.formattedNumber(e/4840,c.ac)+" acres":L.GeometryUtil.formattedNumber(e,c.yd)+" yd²"),l},readableDistance:function(e,i,n,l,u){var c,u=L.Util.extend({},t,u);switch(i?typeof i=="string"?i:"metric":n?"feet":l?"nauticalMile":"yards"){case"metric":c=e>1e3?L.GeometryUtil.formattedNumber(e/1e3,u.km)+" km":L.GeometryUtil.formattedNumber(e,u.m)+" m";break;case"feet":e*=3.28083,c=L.GeometryUtil.formattedNumber(e,u.ft)+" ft";break;case"nauticalMile":e*=.53996,c=L.GeometryUtil.formattedNumber(e/1e3,u.nm)+" nm";break;case"yards":default:e*=1.09361,c=e>1760?L.GeometryUtil.formattedNumber(e/1760,u.mi)+" miles":L.GeometryUtil.formattedNumber(e,u.yd)+" yd"}return c},isVersion07x:function(){var e=L.version.split(".");return parseInt(e[0],10)===0&&parseInt(e[1],10)===7}})}(),L.Util.extend(L.LineUtil,{segmentsIntersect:function(t,e,i,n){return this._checkCounterclockwise(t,i,n)!==this._checkCounterclockwise(e,i,n)&&this._checkCounterclockwise(t,e,i)!==this._checkCounterclockwise(t,e,n)},_checkCounterclockwise:function(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}}),L.Polyline.include({intersects:function(){var t,e,i,n=this._getProjectedPoints(),l=n?n.length:0;if(this._tooFewPointsForIntersection())return!1;for(t=l-1;t>=3;t--)if(e=n[t-1],i=n[t],this._lineSegmentsIntersectsRange(e,i,t-2))return!0;return!1},newLatLngIntersects:function(t,e){return!!this._map&&this.newPointIntersects(this._map.latLngToLayerPoint(t),e)},newPointIntersects:function(t,e){var i=this._getProjectedPoints(),n=i?i.length:0,l=i?i[n-1]:null,h=n-2;return!this._tooFewPointsForIntersection(1)&&this._lineSegmentsIntersectsRange(l,t,h,e?1:0)},_tooFewPointsForIntersection:function(t){var e=this._getProjectedPoints(),i=e?e.length:0;return i+=t||0,!e||i<=3},_lineSegmentsIntersectsRange:function(t,e,i,n){var l,h,c=this._getProjectedPoints();n=n||0;for(var u=i;u>n;u--)if(l=c[u-1],h=c[u],L.LineUtil.segmentsIntersect(t,e,l,h))return!0;return!1},_getProjectedPoints:function(){if(!this._defaultShape)return this._originalPoints;for(var t=[],e=this._defaultShape(),i=0;i<e.length;i++)t.push(this._map.latLngToLayerPoint(e[i]));return t}}),L.Polygon.include({intersects:function(){var t,e,i,n,l=this._getProjectedPoints();return!this._tooFewPointsForIntersection()&&(!!L.Polyline.prototype.intersects.call(this)||(t=l.length,e=l[0],i=l[t-1],n=t-2,this._lineSegmentsIntersectsRange(i,e,n,1)))}}),L.Control.Draw=L.Control.extend({options:{position:"topleft",draw:{},edit:!1},initialize:function(t){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");L.Control.prototype.initialize.call(this,t);var e;this._toolbars={},L.DrawToolbar&&this.options.draw&&(e=new L.DrawToolbar(this.options.draw),this._toolbars[L.DrawToolbar.TYPE]=e,this._toolbars[L.DrawToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.EditToolbar&&this.options.edit&&(e=new L.EditToolbar(this.options.edit),this._toolbars[L.EditToolbar.TYPE]=e,this._toolbars[L.EditToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.toolbar=this},onAdd:function(t){var e,i=L.DomUtil.create("div","leaflet-draw"),n=!1;for(var l in this._toolbars)this._toolbars.hasOwnProperty(l)&&(e=this._toolbars[l].addToolbar(t))&&(n||(L.DomUtil.hasClass(e,"leaflet-draw-toolbar-top")||L.DomUtil.addClass(e.childNodes[0],"leaflet-draw-toolbar-top"),n=!0),i.appendChild(e));return i},onRemove:function(){for(var t in this._toolbars)this._toolbars.hasOwnProperty(t)&&this._toolbars[t].removeToolbar()},setDrawingOptions:function(t){for(var e in this._toolbars)this._toolbars[e]instanceof L.DrawToolbar&&this._toolbars[e].setOptions(t)},_toolbarEnabled:function(t){var e=t.target;for(var i in this._toolbars)this._toolbars[i]!==e&&this._toolbars[i].disable()}}),L.Map.mergeOptions({drawControlTooltips:!0,drawControl:!1}),L.Map.addInitHook(function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))}),L.Toolbar=L.Class.extend({initialize:function(t){L.setOptions(this,t),this._modes={},this._actionButtons=[],this._activeMode=null;var e=L.version.split(".");parseInt(e[0],10)===1&&parseInt(e[1],10)>=2?L.Toolbar.include(L.Evented.prototype):L.Toolbar.include(L.Mixin.Events)},enabled:function(){return this._activeMode!==null},disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(t){var e,i=L.DomUtil.create("div","leaflet-draw-section"),n=0,l=this._toolbarClass||"",h=this.getModeHandlers(t);for(this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-bar"),this._map=t,e=0;e<h.length;e++)h[e].enabled&&this._initModeHandler(h[e].handler,this._toolbarContainer,n++,l,h[e].title);if(n)return this._lastButtonIndex=--n,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),i.appendChild(this._toolbarContainer),i.appendChild(this._actionsContainer),i},removeToolbar:function(){for(var t in this._modes)this._modes.hasOwnProperty(t)&&(this._disposeButton(this._modes[t].button,this._modes[t].handler.enable,this._modes[t].handler),this._modes[t].handler.disable(),this._modes[t].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};for(var e=0,i=this._actionButtons.length;e<i;e++)this._disposeButton(this._actionButtons[e].button,this._actionButtons[e].callback,this);this._actionButtons=[],this._actionsContainer=null},_initModeHandler:function(t,e,i,n,l){var h=t.type;this._modes[h]={},this._modes[h].handler=t,this._modes[h].button=this._createButton({type:h,title:l,className:n+"-"+h,container:e,callback:this._modes[h].handler.enable,context:this._modes[h].handler}),this._modes[h].buttonIndex=i,this._modes[h].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_detectIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!o.MSStream},_createButton:function(t){var e=L.DomUtil.create("a",t.className||"",t.container),i=L.DomUtil.create("span","sr-only",t.container);e.href="#",e.appendChild(i),t.title&&(e.title=t.title,i.innerHTML=t.title),t.text&&(e.innerHTML=t.text,i.innerHTML=t.text);var n=this._detectIOS()?"touchstart":"click";return L.DomEvent.on(e,"click",L.DomEvent.stopPropagation).on(e,"mousedown",L.DomEvent.stopPropagation).on(e,"dblclick",L.DomEvent.stopPropagation).on(e,"touchstart",L.DomEvent.stopPropagation).on(e,"click",L.DomEvent.preventDefault).on(e,n,t.callback,t.context),e},_disposeButton:function(t,e){var i=this._detectIOS()?"touchstart":"click";L.DomEvent.off(t,"click",L.DomEvent.stopPropagation).off(t,"mousedown",L.DomEvent.stopPropagation).off(t,"dblclick",L.DomEvent.stopPropagation).off(t,"touchstart",L.DomEvent.stopPropagation).off(t,"click",L.DomEvent.preventDefault).off(t,i,e)},_handlerActivated:function(t){this.disable(),this._activeMode=this._modes[t.handler],L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._showActionsToolbar(),this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar(),L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._activeMode=null,this.fire("disable")},_createActions:function(t){var e,i,n,l,h=this._actionsContainer,c=this.getActions(t),u=c.length;for(i=0,n=this._actionButtons.length;i<n;i++)this._disposeButton(this._actionButtons[i].button,this._actionButtons[i].callback);for(this._actionButtons=[];h.firstChild;)h.removeChild(h.firstChild);for(var m=0;m<u;m++)"enabled"in c[m]&&!c[m].enabled||(e=L.DomUtil.create("li","",h),l=this._createButton({title:c[m].title,text:c[m].text,container:e,callback:c[m].callback,context:c[m].context}),this._actionButtons.push({button:l,callback:c[m].callback}))},_showActionsToolbar:function(){var t=this._activeMode.buttonIndex,e=this._lastButtonIndex,i=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler),this._actionsContainer.style.top=i+"px",t===0&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top")),t===e&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom")),this._actionsContainer.style.display="block",this._map.fire(L.Draw.Event.TOOLBAROPENED)},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom"),this._map.fire(L.Draw.Event.TOOLBARCLOSED)}}),L.Draw=L.Draw||{},L.Draw.Tooltip=L.Class.extend({initialize:function(t){this._map=t,this._popupPane=t._panes.popupPane,this._visible=!1,this._container=t.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null,this._singleLineLabel=!1,this._map.on("mouseout",this._onMouseOut,this)},dispose:function(){this._map.off("mouseout",this._onMouseOut,this),this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(t){return this._container?(t.subtext=t.subtext||"",t.subtext.length!==0||this._singleLineLabel?t.subtext.length>0&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(t.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+t.subtext+"</span><br />":"")+"<span>"+t.text+"</span>",t.text||t.subtext?(this._visible=!0,this._container.style.visibility="inherit"):(this._visible=!1,this._container.style.visibility="hidden"),this):this},updatePosition:function(t){var e=this._map.latLngToLayerPoint(t),i=this._container;return this._container&&(this._visible&&(i.style.visibility="inherit"),L.DomUtil.setPosition(i,e)),this},showAsError:function(){return this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this},_onMouseOut:function(){this._container&&(this._container.style.visibility="hidden")}}),L.DrawToolbar=L.Toolbar.extend({statics:{TYPE:"draw"},options:{polyline:{},polygon:{},rectangle:{},circle:{},marker:{},circlemarker:{}},initialize:function(t){for(var e in this.options)this.options.hasOwnProperty(e)&&t[e]&&(t[e]=L.extend({},this.options[e],t[e]));this._toolbarClass="leaflet-draw-draw",L.Toolbar.prototype.initialize.call(this,t)},getModeHandlers:function(t){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(t,this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(t,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(t,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Draw.Circle(t,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(t,this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker},{enabled:this.options.circlemarker,handler:new L.Draw.CircleMarker(t,this.options.circlemarker),title:L.drawLocal.draw.toolbar.buttons.circlemarker}]},getActions:function(t){return[{enabled:t.completeShape,title:L.drawLocal.draw.toolbar.finish.title,text:L.drawLocal.draw.toolbar.finish.text,callback:t.completeShape,context:t},{enabled:t.deleteLastVertex,title:L.drawLocal.draw.toolbar.undo.title,text:L.drawLocal.draw.toolbar.undo.text,callback:t.deleteLastVertex,context:t},{title:L.drawLocal.draw.toolbar.actions.title,text:L.drawLocal.draw.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(t){L.setOptions(this,t);for(var e in this._modes)this._modes.hasOwnProperty(e)&&t.hasOwnProperty(e)&&this._modes[e].handler.setOptions(t[e])}}),L.EditToolbar=L.Toolbar.extend({statics:{TYPE:"edit"},options:{edit:{selectedPathOptions:{dashArray:"10, 10",fill:!0,fillColor:"#fe57a1",fillOpacity:.1,maintainColor:!1}},remove:{},poly:null,featureGroup:null},initialize:function(t){t.edit&&(t.edit.selectedPathOptions===void 0&&(t.edit.selectedPathOptions=this.options.edit.selectedPathOptions),t.edit.selectedPathOptions=L.extend({},this.options.edit.selectedPathOptions,t.edit.selectedPathOptions)),t.remove&&(t.remove=L.extend({},this.options.remove,t.remove)),t.poly&&(t.poly=L.extend({},this.options.poly,t.poly)),this._toolbarClass="leaflet-draw-edit",L.Toolbar.prototype.initialize.call(this,t),this._selectedFeatureCount=0},getModeHandlers:function(t){var e=this.options.featureGroup;return[{enabled:this.options.edit,handler:new L.EditToolbar.Edit(t,{featureGroup:e,selectedPathOptions:this.options.edit.selectedPathOptions,poly:this.options.poly}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:this.options.remove,handler:new L.EditToolbar.Delete(t,{featureGroup:e}),title:L.drawLocal.edit.toolbar.buttons.remove}]},getActions:function(t){var e=[{title:L.drawLocal.edit.toolbar.actions.save.title,text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,callback:this.disable,context:this}];return t.removeAllLayers&&e.push({title:L.drawLocal.edit.toolbar.actions.clearAll.title,text:L.drawLocal.edit.toolbar.actions.clearAll.text,callback:this._clearAllLayers,context:this}),e},addToolbar:function(t){var e=L.Toolbar.prototype.addToolbar.call(this,t);return this._checkDisabled(),this.options.featureGroup.on("layeradd layerremove",this._checkDisabled,this),e},removeToolbar:function(){this.options.featureGroup.off("layeradd layerremove",this._checkDisabled,this),L.Toolbar.prototype.removeToolbar.call(this)},disable:function(){this.enabled()&&(this._activeMode.handler.revertLayers(),L.Toolbar.prototype.disable.call(this))},_save:function(){this._activeMode.handler.save(),this._activeMode&&this._activeMode.handler.disable()},_clearAllLayers:function(){this._activeMode.handler.removeAllLayers(),this._activeMode&&this._activeMode.handler.disable()},_checkDisabled:function(){var t,e=this.options.featureGroup,i=e.getLayers().length!==0;this.options.edit&&(t=this._modes[L.EditToolbar.Edit.TYPE].button,i?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",i?L.drawLocal.edit.toolbar.buttons.edit:L.drawLocal.edit.toolbar.buttons.editDisabled)),this.options.remove&&(t=this._modes[L.EditToolbar.Delete.TYPE].button,i?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",i?L.drawLocal.edit.toolbar.buttons.remove:L.drawLocal.edit.toolbar.buttons.removeDisabled))}}),L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),L.setOptions(this,e),this._featureGroup=e.featureGroup,!(this._featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={},this.type=L.EditToolbar.Edit.TYPE;var i=L.version.split(".");parseInt(i[0],10)===1&&parseInt(i[1],10)>=2?L.EditToolbar.Edit.include(L.Evented.prototype):L.EditToolbar.Edit.include(L.Mixin.Events)},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.EDITSTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.EDITSTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}),t._editTooltip=this._tooltip,this._updateTooltip(),this._map.on("mousemove",this._onMouseMove,this).on("touchmove",this._onMouseMove,this).on("MSPointerMove",this._onMouseMove,this).on(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this).off("touchmove",this._onMouseMove,this).off("MSPointerMove",this._onMouseMove,this).off(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},revertLayers:function(){this._featureGroup.eachLayer(function(t){this._revertLayer(t)},this)},save:function(){var t=new L.LayerGroup;this._featureGroup.eachLayer(function(e){e.edited&&(t.addLayer(e),e.edited=!1)}),this._map.fire(L.Draw.Event.EDITED,{layers:t})},_backupLayer:function(t){var e=L.Util.stamp(t);this._uneditedLayerProps[e]||(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?this._uneditedLayerProps[e]={latlngs:L.LatLngUtil.cloneLatLngs(t.getLatLngs())}:t instanceof L.Circle?this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng()),radius:t.getRadius()}:(t instanceof L.Marker||t instanceof L.CircleMarker)&&(this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng())}))},_getTooltipText:function(){return{text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}},_updateTooltip:function(){this._tooltip.updateContent(this._getTooltipText())},_revertLayer:function(t){var e=L.Util.stamp(t);t.edited=!1,this._uneditedLayerProps.hasOwnProperty(e)&&(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?t.setLatLngs(this._uneditedLayerProps[e].latlngs):t instanceof L.Circle?(t.setLatLng(this._uneditedLayerProps[e].latlng),t.setRadius(this._uneditedLayerProps[e].radius)):(t instanceof L.Marker||t instanceof L.CircleMarker)&&t.setLatLng(this._uneditedLayerProps[e].latlng),t.fire("revert-edited",{layer:t}))},_enableLayerEdit:function(t){var e,i,n=t.layer||t.target||t;this._backupLayer(n),this.options.poly&&(i=L.Util.extend({},this.options.poly),n.options.poly=i),this.options.selectedPathOptions&&(e=L.Util.extend({},this.options.selectedPathOptions),e.maintainColor&&(e.color=n.options.color,e.fillColor=n.options.fillColor),n.options.original=L.extend({},n.options),n.options.editing=e),n instanceof L.Marker?(n.editing&&n.editing.enable(),n.dragging.enable(),n.on("dragend",this._onMarkerDragEnd).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onMarkerDragEnd,this).on("MSPointerUp",this._onMarkerDragEnd,this)):n.editing.enable()},_disableLayerEdit:function(t){var e=t.layer||t.target||t;e.edited=!1,e.editing&&e.editing.disable(),delete e.options.editing,delete e.options.original,this._selectedPathOptions&&(e instanceof L.Marker?this._toggleMarkerHighlight(e):(e.setStyle(e.options.previousOptions),delete e.options.previousOptions)),e instanceof L.Marker?(e.dragging.disable(),e.off("dragend",this._onMarkerDragEnd,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onMarkerDragEnd,this).off("MSPointerUp",this._onMarkerDragEnd,this)):e.editing.disable()},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_onMarkerDragEnd:function(t){var e=t.target;e.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:e})},_onTouchMove:function(t){var e=t.originalEvent.changedTouches[0],i=this._map.mouseEventToLayerPoint(e),n=this._map.layerPointToLatLng(i);t.target.setLatLng(n)},_hasAvailableLayers:function(){return this._featureGroup.getLayers().length!==0}}),L.EditToolbar.Delete=L.Handler.extend({statics:{TYPE:"remove"},initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),L.Util.setOptions(this,e),this._deletableLayers=this.options.featureGroup,!(this._deletableLayers instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this.type=L.EditToolbar.Delete.TYPE;var i=L.version.split(".");parseInt(i[0],10)===1&&parseInt(i[1],10)>=2?L.EditToolbar.Delete.include(L.Evented.prototype):L.EditToolbar.Delete.include(L.Mixin.Events)},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DELETESTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disable:function(){this._enabled&&(this._deletableLayers.off("layeradd",this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DELETESTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._deletableLayers.eachLayer(this._enableLayerDelete,this),this._deletedLayers=new L.LayerGroup,this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.remove.tooltip.text}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._deletableLayers.eachLayer(this._disableLayerDelete,this),this._deletedLayers=null,this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._deletedLayers.eachLayer(function(t){this._deletableLayers.addLayer(t),t.fire("revert-deleted",{layer:t})},this)},save:function(){this._map.fire(L.Draw.Event.DELETED,{layers:this._deletedLayers})},removeAllLayers:function(){this._deletableLayers.eachLayer(function(t){this._removeLayer({layer:t})},this),this.save()},_enableLayerDelete:function(t){(t.layer||t.target||t).on("click",this._removeLayer,this)},_disableLayerDelete:function(t){var e=t.layer||t.target||t;e.off("click",this._removeLayer,this),this._deletedLayers.removeLayer(e)},_removeLayer:function(t){var e=t.layer||t.target||t;this._deletableLayers.removeLayer(e),this._deletedLayers.addLayer(e),e.fire("deleted")},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_hasAvailableLayers:function(){return this._deletableLayers.getLayers().length!==0}})})(window,document);var Zt=function o(r,s){if(r===s)return!0;if(r&&s&&typeof r=="object"&&typeof s=="object"){if(r.constructor!==s.constructor)return!1;var a,t,e;if(Array.isArray(r)){if(a=r.length,a!=s.length)return!1;for(t=a;t--!==0;)if(!o(r[t],s[t]))return!1;return!0}if(r.constructor===RegExp)return r.source===s.source&&r.flags===s.flags;if(r.valueOf!==Object.prototype.valueOf)return r.valueOf()===s.valueOf();if(r.toString!==Object.prototype.toString)return r.toString()===s.toString();if(e=Object.keys(r),a=e.length,a!==Object.keys(s).length)return!1;for(t=a;t--!==0;)if(!Object.prototype.hasOwnProperty.call(s,e[t]))return!1;for(t=a;t--!==0;){var i=e[t];if(!o(r[i],s[i]))return!1}return!0}return r!==r&&s!==s};const ht=Rt(Zt);function ct(o,r){var s=Object.keys(o);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(o);r&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable})),s.push.apply(s,a)}return s}function H(o){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?ct(Object(s),!0).forEach(function(a){Yt(o,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(s)):ct(Object(s)).forEach(function(a){Object.defineProperty(o,a,Object.getOwnPropertyDescriptor(s,a))})}return o}function Yt(o,r,s){return r in o?Object.defineProperty(o,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):o[r]=s,o}var T={onEdited:"draw:edited",onDrawStart:"draw:drawstart",onDrawStop:"draw:drawstop",onDrawVertex:"draw:drawvertex",onEditStart:"draw:editstart",onEditMove:"draw:editmove",onEditResize:"draw:editresize",onEditVertex:"draw:editvertex",onEditStop:"draw:editstop",onDeleted:"draw:deleted",onDeleteStart:"draw:deletestart",onDeleteStop:"draw:deletestop"};function yt(o){var r=Ut(),s=g.useRef(),a=g.useRef(o),t=function(i){var n=o.onCreated,l=r.layerContainer||r.map;l.addLayer(i.layer),n&&n(i)};return at.useEffect(function(){var e=r.map,i=o.onMounted;for(var n in T)e.on(T[n],function(l){var h=Object.keys(T).filter(function(u){return T[u]===l.type});if(h.length===1){var c=h[0];o[c]&&o[c](l)}});return e.on(lt.Draw.Event.CREATED,t),s.current=dt(o,r),e.addControl(s.current),i&&i(s.current),function(){e.off(lt.Draw.Event.CREATED,t);for(var l in T)o[l]&&e.off(T[l],o[l]);s.current.remove(e)}},[]),at.useEffect(function(){if(!(ht(o.draw,a.current.draw)&&ht(o.edit,a.current.edit)&&o.position===a.current.position)){var e=r.map;s.current.remove(e),s.current=dt(o,r),s.current.addTo(e);var i=o.onMounted;return i&&i(s.current),function(){s.current.remove(e)}}},[o.draw,o.edit,o.position]),null}function dt(o,r){var s=r.layerContainer,a=o.draw,t=o.edit,e=o.position,i={edit:H(H({},t),{},{featureGroup:s})};return a&&(i.draw=H({},a)),e&&(i.position=e),new w.Control.Draw(i)}yt.propTypes=H(H({},Object.keys(T).reduce(function(o,r){return o[r]=f.PropTypes.func,o},{})),{},{onCreated:f.PropTypes.func,onMounted:f.PropTypes.func,draw:f.PropTypes.shape({polyline:f.PropTypes.oneOfType([f.PropTypes.object,f.PropTypes.bool]),polygon:f.PropTypes.oneOfType([f.PropTypes.object,f.PropTypes.bool]),rectangle:f.PropTypes.oneOfType([f.PropTypes.object,f.PropTypes.bool]),circle:f.PropTypes.oneOfType([f.PropTypes.object,f.PropTypes.bool]),marker:f.PropTypes.oneOfType([f.PropTypes.object,f.PropTypes.bool])}),edit:f.PropTypes.shape({edit:f.PropTypes.oneOfType([f.PropTypes.object,f.PropTypes.bool]),remove:f.PropTypes.oneOfType([f.PropTypes.object,f.PropTypes.bool]),poly:f.PropTypes.oneOfType([f.PropTypes.object,f.PropTypes.bool]),allowIntersection:f.PropTypes.bool}),position:f.PropTypes.oneOf(["topright","topleft","bottomright","bottomleft"]),leaflet:f.PropTypes.shape({map:f.PropTypes.instanceOf(w.Map),layerContainer:f.PropTypes.shape({addLayer:f.PropTypes.func.isRequired,removeLayer:f.PropTypes.func.isRequired})})});var b=[];for(var W=0;W<256;++W)b.push((W+256).toString(16).slice(1));function qt(o,r=0){return(b[o[r+0]]+b[o[r+1]]+b[o[r+2]]+b[o[r+3]]+"-"+b[o[r+4]]+b[o[r+5]]+"-"+b[o[r+6]]+b[o[r+7]]+"-"+b[o[r+8]]+b[o[r+9]]+"-"+b[o[r+10]]+b[o[r+11]]+b[o[r+12]]+b[o[r+13]]+b[o[r+14]]+b[o[r+15]]).toLowerCase()}var F,$t=new Uint8Array(16);function Wt(){if(!F&&(F=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!F))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return F($t)}var Xt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const pt={randomUUID:Xt};function Kt(o,r,s){if(pt.randomUUID&&!r&&!o)return pt.randomUUID();o=o||{};var a=o.random||(o.rng||Wt)();return a[6]=a[6]&15|64,a[8]=a[8]&63|128,qt(a)}function C(){return C=Object.assign?Object.assign.bind():function(o){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(o[a]=s[a])}return o},C.apply(this,arguments)}function Qt(o,r){o.prototype=Object.create(r.prototype),o.prototype.constructor=o,V(o,r)}function V(o,r){return V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,a){return s.__proto__=a,s},V(o,r)}function Jt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Q(o,r,s){return Q=Jt()?Reflect.construct.bind():function(a,t,e){var i=[null];i.push.apply(i,t);var n=new(Function.bind.apply(a,i));return e&&V(n,e.prototype),n},Q.apply(null,arguments)}function D(o,r,s,a){r===void 0&&(r=""),a===void 0&&(a={});var t=document.createElement(o);return r&&(t.className=r),Object.keys(a).forEach(function(e){if(typeof a[e]=="function"){var i=e.indexOf("on")===0?e.substr(2).toLowerCase():e;t.addEventListener(i,a[e])}else e==="html"?t.innerHTML=a[e]:e==="text"?t.innerText=a[e]:t.setAttribute(e,a[e])}),s&&s.appendChild(t),t}function z(o){o.preventDefault(),o.stopPropagation()}var B=function(){return[].slice.call(arguments).filter(Boolean).join(" ").trim()};function P(o,r){o&&o.classList&&(Array.isArray(r)?r:[r]).forEach(function(s){o.classList.contains(s)||o.classList.add(s)})}function E(o,r){o&&o.classList&&(Array.isArray(r)?r:[r]).forEach(function(s){o.classList.contains(s)&&o.classList.remove(s)})}var Z,Y=13,J=40,bt=38,te=[Y,27,J,bt,37,39],ee=function(){function o(s){var a=this,t=s.handleSubmit,e=s.searchLabel,i=s.classNames,n=i===void 0?{}:i;this.container=void 0,this.form=void 0,this.input=void 0,this.handleSubmit=void 0,this.hasError=!1,this.container=D("div",B("geosearch",n.container)),this.form=D("form",["",n.form].join(" "),this.container,{autocomplete:"none",onClick:z,onDblClick:z,touchStart:z,touchEnd:z}),this.input=D("input",["glass",n.input].join(" "),this.form,{type:"text",placeholder:e||"search",onInput:this.onInput,onKeyUp:function(l){return a.onKeyUp(l)},onKeyPress:function(l){return a.onKeyPress(l)},onFocus:this.onFocus,onBlur:this.onBlur,onClick:function(){a.input.focus(),a.input.dispatchEvent(new Event("focus"))}}),this.handleSubmit=t}var r=o.prototype;return r.onFocus=function(){P(this.form,"active")},r.onBlur=function(){E(this.form,"active")},r.onSubmit=function(s){try{var a=this;return z(s),E(t=a.container,"error"),P(t,"pending"),Promise.resolve(a.handleSubmit({query:a.input.value})).then(function(){E(a.container,"pending")})}catch(e){return Promise.reject(e)}var t},r.onInput=function(){this.hasError&&(E(this.container,"error"),this.hasError=!1)},r.onKeyUp=function(s){s.keyCode===27&&(E(this.container,["pending","active"]),this.input.value="",document.body.focus(),document.body.blur())},r.onKeyPress=function(s){s.keyCode===Y&&this.onSubmit(s)},r.setQuery=function(s){this.input.value=s},o}(),ie=function(){function o(s){var a=this,t=s.handleClick,e=s.classNames,i=e===void 0?{}:e,n=s.notFoundMessage;this.handleClick=void 0,this.selected=-1,this.results=[],this.container=void 0,this.resultItem=void 0,this.notFoundMessage=void 0,this.onClick=function(l){if(typeof a.handleClick=="function"){var h=l.target;if(h&&a.container.contains(h)&&h.hasAttribute("data-key")){var c=Number(h.getAttribute("data-key"));a.handleClick({result:a.results[c]})}}},this.handleClick=t,this.notFoundMessage=n?D("div",B(i.notfound),void 0,{html:n}):void 0,this.container=D("div",B("results",i.resultlist)),this.container.addEventListener("click",this.onClick,!0),this.resultItem=D("div",B(i.item))}var r=o.prototype;return r.render=function(s,a){var t=this;s===void 0&&(s=[]),this.clear(),s.forEach(function(e,i){var n=t.resultItem.cloneNode(!0);n.setAttribute("data-key",""+i),n.innerHTML=a({result:e}),t.container.appendChild(n)}),s.length>0?(P(this.container.parentElement,"open"),P(this.container,"active")):this.notFoundMessage&&(this.container.appendChild(this.notFoundMessage),P(this.container.parentElement,"open")),this.results=s},r.select=function(s){return Array.from(this.container.children).forEach(function(a,t){return t===s?P(a,"active"):E(a,"active")}),this.selected=s,this.results[s]},r.count=function(){return this.results?this.results.length:0},r.clear=function(){for(this.selected=-1;this.container.lastChild;)this.container.removeChild(this.container.lastChild);E(this.container.parentElement,"open"),E(this.container,"active")},o}(),X={position:"topleft",style:"button",showMarker:!0,showPopup:!1,popupFormat:function(o){return""+o.result.label},resultFormat:function(o){return""+o.result.label},marker:{icon:tt&&w.Icon?new w.Icon.Default:void 0,draggable:!1},maxMarkers:1,maxSuggestions:5,retainZoomLevel:!1,animateZoom:!0,searchLabel:"Enter address",clearSearchLabel:"Clear search",notFoundMessage:"",messageHideDelay:3e3,zoomLevel:18,classNames:{container:"leaflet-bar leaflet-control leaflet-control-geosearch",button:"leaflet-bar-part leaflet-bar-part-single",resetButton:"reset",msgbox:"leaflet-bar message",form:"",input:"",resultlist:"",item:"",notfound:"leaflet-bar-notfound"},autoComplete:!0,autoCompleteDelay:250,autoClose:!1,keepResult:!1,updateMap:!0},wt="Leaflet must be loaded before instantiating the GeoSearch control",oe={options:C({},X),classNames:C({},X.classNames),initialize:function(o){var r,s,a,t,e=this;if(!tt)throw new Error(wt);if(!o.provider)throw new Error("Provider is missing from options");this.options=C({},X,o),this.classNames=C({},this.classNames,o.classNames),this.markers=new w.FeatureGroup,this.classNames.container+=" leaflet-geosearch-"+this.options.style,this.searchElement=new ee({searchLabel:this.options.searchLabel,classNames:{container:this.classNames.container,form:this.classNames.form,input:this.classNames.input},handleSubmit:function(i){return e.onSubmit(i)}}),this.button=D("a",this.classNames.button,this.searchElement.container,{title:this.options.searchLabel,href:"#",onClick:function(i){return e.onClick(i)}}),w.DomEvent.disableClickPropagation(this.button),this.resetButton=D("button",this.classNames.resetButton,this.searchElement.form,{text:"×","aria-label":this.options.clearSearchLabel,onClick:function(){e.searchElement.input.value===""?e.close():e.clearResults(null,!0)}}),w.DomEvent.disableClickPropagation(this.resetButton),this.options.autoComplete&&(this.resultList=new ie({handleClick:function(i){var n=i.result;e.searchElement.input.value=n.label,e.onSubmit({query:n.label,data:n})},classNames:{resultlist:this.classNames.resultlist,item:this.classNames.item,notfound:this.classNames.notfound},notFoundMessage:this.options.notFoundMessage}),this.searchElement.form.appendChild(this.resultList.container),this.searchElement.input.addEventListener("keyup",(r=function(i){return e.autoSearch(i)},(s=this.options.autoCompleteDelay)===void 0&&(s=250),a===void 0&&(a=!1),function(){var i=[].slice.call(arguments);t&&clearTimeout(t),t=setTimeout(function(){t=null,a||r.apply(void 0,i)},s),a&&!t&&r.apply(void 0,i)}),!0),this.searchElement.input.addEventListener("keydown",function(i){return e.selectResult(i)},!0),this.searchElement.input.addEventListener("keydown",function(i){return e.clearResults(i,!0)},!0)),this.searchElement.form.addEventListener("click",function(i){i.preventDefault()},!1)},onAdd:function(o){var r=this.options,s=r.showMarker,a=r.style;if(this.map=o,s&&this.markers.addTo(o),a==="bar"){var t=o.getContainer().querySelector(".leaflet-control-container");this.container=D("div","leaflet-control-geosearch leaflet-geosearch-bar"),this.container.appendChild(this.searchElement.form),t.appendChild(this.container)}return w.DomEvent.disableClickPropagation(this.searchElement.form),this.searchElement.container},onRemove:function(){var o;return(o=this.container)==null||o.remove(),this},open:function(){var o=this.searchElement,r=o.input;P(o.container,"active"),r.focus()},close:function(){E(this.searchElement.container,"active"),this.clearResults()},onClick:function(o){o.preventDefault(),o.stopPropagation(),this.searchElement.container.classList.contains("active")?this.close():this.open()},selectResult:function(o){if([Y,J,bt].indexOf(o.keyCode)!==-1)if(o.preventDefault(),o.keyCode!==Y){var r=this.resultList.count()-1;if(!(r<0)){var s=this.resultList.selected,a=o.keyCode===J?s+1:s-1,t=this.resultList.select(a<0?r:a>r?0:a);this.searchElement.input.value=t.label}}else{var e=this.resultList.select(this.resultList.selected);this.onSubmit({query:this.searchElement.input.value,data:e})}},clearResults:function(o,r){if(r===void 0&&(r=!1),!o||o.keyCode===27){var s=this.options,a=s.autoComplete;!r&&s.keepResult||(this.searchElement.input.value="",this.markers.clearLayers()),a&&this.resultList.clear()}},autoSearch:function(o){try{var r=this;if(te.indexOf(o.keyCode)>-1)return Promise.resolve();var s=o.target.value,a=r.options.provider,t=function(){if(s.length)return Promise.resolve(a.search({query:s})).then(function(e){e=e.slice(0,r.options.maxSuggestions),r.resultList.render(e,r.options.resultFormat)});r.resultList.clear()}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},onSubmit:function(o){try{var r=this;return r.resultList.clear(),Promise.resolve(r.options.provider.search(o)).then(function(s){s&&s.length>0&&r.showResult(s[0],o)})}catch(s){return Promise.reject(s)}},showResult:function(o,r){var s=this.options,a=s.autoClose,t=s.updateMap,e=this.markers.getLayers();e.length>=this.options.maxMarkers&&this.markers.removeLayer(e[0]);var i=this.addMarker(o,r);t&&this.centerMap(o),this.map.fireEvent("geosearch/showlocation",{location:o,marker:i}),a&&this.closeResults()},closeResults:function(){var o=this.searchElement.container;o.classList.contains("active")&&E(o,"active"),this.clearResults()},addMarker:function(o,r){var s=this,a=this.options,t=a.marker,e=a.showPopup,i=a.popupFormat,n=new w.Marker([o.y,o.x],t),l=o.label;return typeof i=="function"&&(l=i({query:r,result:o})),n.bindPopup(l),this.markers.addLayer(n),e&&n.openPopup(),t.draggable&&n.on("dragend",function(h){s.map.fireEvent("geosearch/marker/dragend",{location:n.getLatLng(),event:h})}),n},centerMap:function(o){var r=this.options,s=r.retainZoomLevel,a=r.animateZoom,t=o.bounds?new w.LatLngBounds(o.bounds):new w.LatLng(o.y,o.x).toBounds(10),e=t.isValid()?t:this.markers.getBounds();!s&&t.isValid()&&!o.bounds||s||!t.isValid()?this.map.setView(e.getCenter(),this.getZoom(),{animate:a}):this.map.fitBounds(e,{animate:a})},getZoom:function(){var o=this.options,r=o.zoomLevel;return o.retainZoomLevel?this.map.getZoom():r}};function ne(){if(!tt)throw new Error(wt);var o=w.Control.extend(oe);return Q(o,[].slice.call(arguments))}(function(o){o[o.SEARCH=0]="SEARCH",o[o.REVERSE=1]="REVERSE"})(Z||(Z={}));var re=function(){function o(s){s===void 0&&(s={}),this.options=void 0,this.options=s}var r=o.prototype;return r.getParamString=function(s){s===void 0&&(s={});var a=C({},this.options.params,s);return Object.keys(a).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(a[t])}).join("&")},r.getUrl=function(s,a){return s+"?"+this.getParamString(a)},r.search=function(s){try{var a=this,t=a.endpoint({query:s.query,type:Z.SEARCH});return Promise.resolve(fetch(t)).then(function(e){return Promise.resolve(e.json()).then(function(i){return a.parse({data:i})})})}catch(e){return Promise.reject(e)}},o}();var ut;(function(o){o[o.INITIALIZED=0]="INITIALIZED",o[o.LOADING=1]="LOADING",o[o.SUCCESS=2]="SUCCESS",o[o.FAILURE=3]="FAILURE"})(ut||(ut={}));var se=function(o){function r(a){var t;a===void 0&&(a={}),(t=o.call(this,a)||this).searchUrl=void 0,t.reverseUrl=void 0;var e="https://nominatim.openstreetmap.org";return t.searchUrl=a.searchUrl||e+"/search",t.reverseUrl=a.reverseUrl||e+"/reverse",t}Qt(r,o);var s=r.prototype;return s.endpoint=function(a){var t=a.query,e=a.type,i=typeof t=="string"?{q:t}:t;return i.format="json",this.getUrl(e===Z.REVERSE?this.reverseUrl:this.searchUrl,i)},s.parse=function(a){return(Array.isArray(a.data)?a.data:[a.data]).map(function(t){return{x:Number(t.lon),y:Number(t.lat),label:t.display_name,bounds:[[parseFloat(t.boundingbox[0]),parseFloat(t.boundingbox[2])],[parseFloat(t.boundingbox[1]),parseFloat(t.boundingbox[3])]],raw:t}})},r}(re);const ae=()=>{const o=new se,r=new ne({provider:o}),s=Gt();return g.useEffect(()=>{s.addControl(r);const a=document.querySelector(".leaflet-control-geosearch");a&&(a.style.position="fixed",a.style.top="20px",a.style.left="50%",a.style.transform="translateX(-50%)",a.style.zIndex=1e3,a.style.border="none",a.style.width="70%",a.style.margin=0);const t=a.querySelector("form");t&&(t.style.width="100%");const e=a.querySelector("a");e&&(e.style.display="none");const i=document.querySelector("input.glass");i&&(i.style.width="100%",i.style.height="100%",i.style.outline="none",i.style.backgroundColor="white",i.style.color="black",i.style.padding="10px",i.style.borderRadius="5px",i.style.boxShadow="0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",i.placeholder="Buscar dirección");const n=document.querySelector("button.reset");n&&(n.style.display="none");const l=t.querySelector("div.results");return l&&(l.style.width="100%",l.style.backgroundColor="white",l.style.display="flex",l.style.flexDirection="column",l.style.alignItems="start",l.style.justifyContent="center",l.style.gap="10px",l.style.marginTop="2px"),()=>s.removeControl(r)},[]),null},K=["red","green","blue","yellow","orange","purple","pink","brown","black","white","gray","cyan"],_e=()=>{const[o]=g.useState({lat:39.4033747,lng:-.4028759}),r=15,s=g.useRef(),[a,t]=g.useState([]),[e,i]=g.useState({id:null,latlngs:[]}),[n,l]=g.useState(!1),[h,c]=g.useState(""),[u,m]=g.useState(K[0]),[et,it]=g.useState(),ot=g.useRef(),[nt,kt]=g.useState([]),[rt,Et]=g.useState({}),[st,Mt]=g.useState({});g.useEffect(()=>{},[]),g.useEffect(()=>{(async()=>{try{const d=await x.get("https://estudiolucmar.com/backend/users/fetchNombreApellido.php");console.log("Responsables fetched:",d.data),kt(d.data)}catch(d){console.error("Error fetching responsables:",d)}})()},[]),g.useEffect(()=>{Dt()},[]);const Dt=async()=>{try{const p=await x.get("https://estudiolucmar.com/backend/zonas/fetchAllZones.php");console.log("Zones fetched:",p.data),t(p.data)}catch(p){console.error("Error fetching zones:",p)}},xt=p=>{const{layerType:d,layer:_}=p;if(d==="polygon"){const{_leaflet_id:v}=_,M=_.getLatLngs();i({id:v,latlngs:M}),l(!0),_.setStyle({color:u}),_.bindPopup(document.createElement("div")).openPopup()}},Tt=p=>{console.log("Draw Deleted Event!",p);for(const d in p.layers._layers)if(p.layers._layers.hasOwnProperty(d)){const _=p.layers._layers[d];_.options&&_.options.code_id&&(console.log("Draw Deleted Event! ID:",_.options.code_id),St(_.options.code_id))}},Ct=p=>{console.log("Draw Edited Event!",p);try{Object.values(p.layers._layers).forEach(async d=>{if(d.options&&d.options.code_id){const _=d.options.code_id,v=d.getLatLngs();await Pt(_,v)}})}catch(d){console.error("Error editing zone:",d)}},Pt=async(p,d)=>{try{const _=await x.post("https://estudiolucmar.com/backend/zonas/updateZone.php",{code_id:p,latlngs:d});console.log("Zone updated in backend:",_.data),window.location.reload()}catch(_){throw console.error("Error updating zone:",_),_}},St=async p=>{try{const d=await x.get(`https://estudiolucmar.com/backend/zonas/deleteZone.php?zoneCodeId=${p}`);t(_=>_.filter(v=>v.code_id!==p)),console.log("Zone deleted:",d.data)}catch(d){console.error("Error deleting zone:",d)}};g.useEffect(()=>{console.log("zones changed",a),console.log("zone data changed",e),x.get("https://estudiolucmar.com/backend/zonas/checkInmuebleInZone.php").then(d=>{console.log("Inmueble data fetched:",d.data)}),(async()=>{try{const d=await x.get("https://estudiolucmar.com/backend/zonas/calculateZoneStatistics.php");console.log("Zone statistics fetched:",d.data),Et(d.data)}catch(d){console.error("Error fetching zone statistics:",d)}})()},[a]);const Ot=async()=>{const d={code_id:Kt(),zone_name:h,color:u,zone_responsable:et,latlngs:e.latlngs};try{const _=await x.post("https://estudiolucmar.com/backend/zonas/createNewZone.php",d);console.log("Zone saved:",_.data);const v=ot.current.getLayers().find(M=>M._leaflet_id===e.id);v&&(v.setStyle({color:u}),v.bindPopup(`<div>
              <h3>${h}</h3>
              <p>Responsable: ${et}</p>
            </div>`).openPopup()),i({id:null,latlngs:[]}),c(""),m(K[0]),it(""),l(!1),window.location.reload()}catch(_){console.error("Error saving zone:",_)}};g.useEffect(()=>{(async(d,_)=>d.map(M=>{const q=M.code_id,S=_.filter(k=>k.zone_id===q);let G=0,O=0,N=0,I=0,A=0,R=0,j=0,U=0;S.forEach(k=>{k.encargoState==="0"&&(G+=1),k.encargoState==="1"&&(O+=1),k.noticiastate==="0"&&(N+=1),k.noticiastate==="1"&&(I+=1),k.categoria==="Inquilino"&&(A+=1),k.categoria==="Vacio"&&(R+=1),k.categoria==="Propietario"&&(j+=1),k.categoria===null&&(U+=1)});const $=S.length;return{...M,encargoState0:G,encargoState1:O,noticiaState0:N,noticiaState1:I,categoriaInquilino:A,categoriaVacio:R,categoriaPropietario:j,categoriaNull:U,totalElements:$}}))(a,rt).then(d=>{console.log("zones organized",d),Mt(d)}).catch(d=>{console.error("Error organizing zones:",d)}),console.log("zones pedro",st)},[rt]);const It=(p,d)=>{console.log("Zone clicked:",p);const _=st.find(k=>k.code_id===p.code_id);if(!_){console.error("Zone not found");return}const v=_.totalElements||0;_.noticiaState0;const M=_.noticiaState1||0,q=M/v*100,S=_.encargoState1||0;_.encargoState0;const G=S/v*100,O=_.categoriaInquilino||0,N=O/v*100,I=_.categoriaVacio||0,A=I/v*100,R=_.categoriaPropietario||0,j=R/v*100,U=_.categoriaNull||0,$=U/v*100;d&&d.bindPopup(`
            <div class="flex flex-col items-center pt-2">
            <h3 class="line-height: 20px; text-center font-sans font-bold gap-4" style="margin: 6px;">Nombre: <br> ${_.zone_name}</h3>
              <p class="text-center" style="line-height: 20px; margin: 6px;">Responsable: <br> ${_.zone_responsable}</p>
              <p class="text-center" style="line-height: 20px; margin: 6px;">Total Inmuebles: ${v}</p>
              <p class="text-center" style="line-height: 20px; margin: 6px;">Noticias: ${M} <br> ${q.toFixed(2)}%</p>
              <p class="text-center" style="line-height: 20px; margin: 6px;">Encargos: ${S} <br> ${G.toFixed(2)}%</p>
              <p class="text-center" style="line-height: 20px; margin: 6px;">Propietario: ${R} <br> ${j.toFixed(2)}%</p>
              <p class="text-center" style="line-height: 20px; margin: 6px;">Inquilino: ${O} <br> ${N.toFixed(2)}%</p>
              <p class="text-center" style="line-height: 20px; margin: 6px;">Vacio: ${I} <br> ${A.toFixed(2)}%</p>
              <p class="text-center" style="line-height: 20px; margin: 6px;">Sin Categoria: ${U} <br> ${$.toFixed(2)}%</p>
            </div>
          `).openPopup()};return y.jsxs("div",{className:"w-full flex flex-col items-center justify-start h-dvh bg-red-100",children:[y.jsxs(zt,{center:o,zoom:r,ref:s,className:"w-full h-dvh z-0",children:[y.jsx(Ht,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),y.jsx(ae,{}),y.jsxs(Nt,{ref:ot,children:[a.map(p=>y.jsx(At,{positions:p.latlngs[0].map(d=>[d.lat,d.lng]),color:p.color,eventHandlers:{click:d=>It(p,d.target)},id:p.id,code_id:p.code_id},p.id)),y.jsx(yt,{position:"topright",onCreated:xt,onDeleted:Tt,onEdited:Ct,draw:{rectangle:!1,polyline:!1,circle:!1,circlemarker:!1,marker:!1,polygon:!0}})]})]}),n&&y.jsxs("div",{className:"bg-slate-100 rounded-lg shadow-lg p-4 w-[60%] flex flex-col items-center gap-4 fixed top-[50%] left-[50%] translate-x-[-50%] translate-y-[-50%] z-30",children:[y.jsx("h2",{class:"font-sans text-center text-slate-800 font-bold text-lg",children:"Editar zona"}),y.jsxs("label",{class:"flex flex-col items-center gap-1 w-[60%]",children:["Nombre:",y.jsx("input",{class:"font-sans text-base text-center border-2 border-slate-300 rounded-lg p-1 w-full bg-white",type:"text",value:h,onChange:p=>c(p.target.value)})]}),y.jsxs("label",{class:"flex flex-col items-center gap-1 w-[60%]",children:["Color:",y.jsx("select",{class:"font-sans text-base  text-center border-2 border-slate-300 rounded-lg p-1 w-full bg-white",value:u,onChange:p=>m(p.target.value),children:K.map(p=>y.jsx("option",{class:"text-center",value:p,children:p},p))})]}),y.jsxs("label",{class:"flex flex-col items-center gap-1 w-[60%]",children:["Responsable:",y.jsx("select",{class:"font-sans text-base  text-center border-2 border-slate-300 rounded-lg p-1 w-full bg-white",value:nt,onChange:p=>it(p.target.value),children:nt.map((p,d)=>y.jsx("option",{children:p},d))})]}),y.jsx("button",{class:"font-sans font-bld text-white py-2 px-4 text-center bg-emerald-700 rounded-lg",onClick:Ot,children:"Guardar"})]})]})};export{_e as default};
